<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>宿舍报修管理</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  
  <script>
    tailwind.config = { theme: { extend: { 
      colors: {
        primary: '#3B82F6',
        success: '#10B981',
        warning: '#F59E0B',
        danger: '#EF4444'
      }
    }}}
  </script>
</head>

<body class="bg-gray-50 min-h-screen">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky top-0 z-10">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fa fa-building text-primary text-xl"></i>
        <h1 class="text-lg font-bold text-primary">宿舍报修管理系统</h1>
  </header>

  <!-- 模块导航 -->
  <nav class="bg-white border-b border-gray-200 sticky top-14 z-10">
    <div class="container mx-auto px-4">
      <div class="flex">
        <button class="module-btn active py-3 px-4 text-sm font-medium text-primary border-b-2 border-primary" data-module="repair-handle">
          <i class="fa fa-list-alt mr-1"></i>报修处理
        </button>
        <button class="module-btn py-3 px-4 text-sm font-medium text-gray-500 hover:text-primary" data-module="statistics">
          <i class="fa fa-bar-chart mr-1"></i>统计分析
        </button>
      </div>
    </div>
  </nav>

  <!-- 主内容 -->
  <main class="container mx-auto px-4 py-5">
    <!-- 模块1：报修处理 -->
    <div id="repair-handle" class="module-content">
      <!-- 统计卡片 -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-5">
        <div class="bg-white p-3 rounded-lg shadow-sm border-l-2 border-primary">
          <p class="text-xs text-gray-500">待处理</p>
          <h3 class="text-lg font-bold">8</h3>
        </div>
        <div class="bg-white p-3 rounded-lg shadow-sm border-l-2 border-warning">
          <p class="text-xs text-gray-500">处理中</p>
          <h3 class="text-lg font-bold">12</h3>
        </div>
        <div class="bg-white p-3 rounded-lg shadow-sm border-l-2 border-success">
          <p class="text-xs text-gray-500">已完成</p>
          <h3 class="text-lg font-bold">45</h3>
        </div>
        <div class="bg-white p-3 rounded-lg shadow-sm border-l-2 border-danger">
          <p class="text-xs text-gray-500">本月总计</p>
          <h3 class="text-lg font-bold">65</h3>
        </div>
      </div>

      <!-- 报修列表 -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-5">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-base font-bold flex items-center">
            <i class="fa fa-wrench text-primary mr-2"></i>报修列表
          </h2>
          <select id="statusFilter" class="text-sm border border-gray-200 rounded px-2 py-1">
            <option value="all">全部状态</option>
            <option value="pending">待处理</option>
            <option value="processing">处理中</option>
            <option value="completed">已完成</option>
          </select>
        </div>

        <!-- 搜索框 -->
        <div class="relative mb-4">
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="text" id="searchRepair" placeholder="搜索宿舍号/报修人/问题类型" 
                 class="w-full pl-10 pr-3 py-2 text-sm border border-gray-200 rounded focus:outline-none focus:border-primary">
        </div>

        <!-- 表格 -->
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="bg-gray-50 text-xs text-gray-500">
                <th class="px-3 py-2 text-left">报修编号</th>
                <th class="px-3 py-2 text-left">宿舍号</th>
                <th class="px-3 py-2 text-left">报修人</th>
                <th class="px-3 py-2 text-left">问题类型</th>
                <th class="px-3 py-2 text-left">提交时间</th>
                <th class="px-3 py-2 text-left">状态</th>
                <th class="px-3 py-2 text-left">操作</th>
              </tr>
            </thead>
            <tbody id="repairList">
              <!-- 数据将通过JS动态生成 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 模块2：统计分析 -->
    <div id="statistics" class="module-content hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
        <!-- 报修类型统计 -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h3 class="text-base font-bold mb-3">报修类型分布</h3>
          <div id="typeChart" class="w-full h-64"></div>
        </div>
        
        <!-- 月度趋势统计 -->
        <div class="bg-white p-4 rounded-lg shadow-sm">
          <h3 class="text-base font-bold mb-3">月度报修趋势</h3>
          <div id="monthChart" class="w-full h-64"></div>
        </div>
      </div>
      
      <!-- 楼宇报修统计 -->
      <div class="bg-white p-4 rounded-lg shadow-sm mb-5">
        <h3 class="text-base font-bold mb-3">各楼宇报修数量</h3>
        <div id="buildingChart" class="w-full h-64"></div>
      </div>
      
      <!-- 维修效率统计 -->
      <div class="bg-white p-4 rounded-lg shadow-sm">
        <h3 class="text-base font-bold mb-3">平均处理时长</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="bg-gray-50 text-xs text-gray-500">
                <th class="px-3 py-2 text-left">问题类型</th>
                <th class="px-3 py-2 text-left">平均处理时长</th>
                <th class="px-3 py-2 text-left">最短时长</th>
                <th class="px-3 py-2 text-left">最长时长</th>
                <th class="px-3 py-2 text-left">本月工单量</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-t border-gray-100 hover:bg-gray-50">
                <td class="px-3 py-2">水电维修</td>
                <td class="px-3 py-2">4.2小时</td>
                <td class="px-3 py-2">1.5小时</td>
                <td class="px-3 py-2">12小时</td>
                <td class="px-3 py-2">28</td>
              </tr>
              <tr class="border-t border-gray-100 hover:bg-gray-50">
                <td class="px-3 py-2">家具维修</td>
                <td class="px-3 py-2">1.8天</td>
                <td class="px-3 py-2">1天</td>
                <td class="px-3 py-2">3天</td>
                <td class="px-3 py-2">15</td>
              </tr>
              <tr class="border-t border-gray-100 hover:bg-gray-50">
                <td class="px-3 py-2">电器维修</td>
                <td class="px-3 py-2">2.5天</td>
                <td class="px-3 py-2">1天</td>
                <td class="px-3 py-2">5天</td>
                <td class="px-3 py-2">12</td>
              </tr>
              <tr class="border-t border-gray-100 hover:bg-gray-50">
                <td class="px-3 py-2">网络问题</td>
                <td class="px-3 py-2">6.8小时</td>
                <td class="px-3 py-2">2小时</td>
                <td class="px-3 py-2">24小时</td>
                <td class="px-3 py-2">10</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- 处理报修弹窗 -->
  <div id="handleModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-20">
    <div class="bg-white rounded-lg p-4 max-w-md w-full">
      <h3 class="font-bold mb-3">处理报修 #RX20230615</h3>
      <div class="space-y-3 mb-4">
        <div>
          <label class="block text-xs text-gray-700 mb-1">宿舍号</label>
          <p class="text-sm">3号楼-402</p>
        </div>
        <div>
          <label class="block text-xs text-gray-700 mb-1">报修人</label>
          <p class="text-sm">张三</p>
        </div>
        <div>
          <label class="block text-xs text-gray-700 mb-1">问题描述</label>
          <p class="text-sm">宿舍卫生间水龙头损坏，无法关闭，一直在漏水</p>
        </div>
        
        <!-- 学生上传的图片 -->
        <div>
          <label class="block text-xs text-gray-700 mb-1">问题图片</label>
          <div class="flex gap-2">
            <img src="https://picsum.photos/id/1025/100/100" alt="报修问题图片" class="w-16 h-16 object-cover rounded cursor-pointer" onclick="showImagePreview(this.src)">
          </div>
        </div>
        
        <div>
          <label class="block text-xs text-gray-700 mb-1">处理状态</label>
          <select class="w-full text-sm border border-gray-200 rounded px-2 py-1">
            <option>待处理</option>
            <option>处理中</option>
            <option>已完成</option>
          </select>
        </div>
        
        <!-- 老师上传处理图片 -->
        <div>
          <label class="block text-xs text-gray-700 mb-1">上传处理图片（可选）</label>
          <div class="border border-dashed border-gray-200 rounded p-2 text-center">
            <input type="file" accept="image/*" class="hidden" id="handleImageUpload">
            <label for="handleImageUpload" class="text-xs text-primary cursor-pointer">
              <i class="fa fa-upload mr-1"></i>选择图片上传
            </label>
          </div>
        </div>
        
        <div>
          <label class="block text-xs text-gray-700 mb-1">处理备注</label>
          <textarea class="w-full text-sm border border-gray-200 rounded px-2 py-1" rows="2" placeholder="请输入处理情况"></textarea>
        </div>
      </div>
      <div class="flex gap-2">
        <button id="closeModal" class="flex-1 border border-gray-200 py-1.5 text-sm rounded hover:bg-gray-50">取消</button>
        <button class="flex-1 bg-primary text-white py-1.5 text-sm rounded hover:bg-primary/90">确认处理</button>
      </div>
    </div>
  </div>

  <!-- 图片预览弹窗 -->
  <div id="imagePreviewModal" class="fixed inset-0 bg-black/80 flex items-center justify-center hidden z-50">
    <button id="closeImagePreview" class="absolute top-4 right-4 text-white text-xl">
      <i class="fa fa-times"></i>
    </button>
    <img id="previewImage" src="" alt="图片预览" class="max-w-[90%] max-h-[90vh]">
  </div>

  <script>
    // 模块切换功能
    document.querySelectorAll('.module-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // 切换按钮样式
        document.querySelectorAll('.module-btn').forEach(b => {
          b.classList.remove('active', 'text-primary', 'border-b-2', 'border-primary');
          b.classList.add('text-gray-500');
        });
        this.classList.add('active', 'text-primary', 'border-b-2', 'border-primary');
        this.classList.remove('text-gray-500');
        
        // 切换模块内容
        const module = this.getAttribute('data-module');
        document.querySelectorAll('.module-content').forEach(content => {
          content.classList.add('hidden');
        });
        document.getElementById(module).classList.remove('hidden');
        
        // 如果是统计模块，初始化图表
        if (module === 'statistics') {
          initCharts();
        }
      });
    });

    // 报修数据
    const repairs = [
      {id: 'RX20230615', dorm: '3号楼-402', name: '张三', type: '水电维修', time: '2023-06-15 08:30', status: 'pending'},
      {id: 'RX20230614', dorm: '1号楼-205', name: '李四', type: '家具维修', time: '2023-06-14 16:45', status: 'processing'},
      {id: 'RX20230614', dorm: '2号楼-501', name: '王五', type: '电器维修', time: '2023-06-14 10:20', status: 'completed'},
      {id: 'RX20230613', dorm: '4号楼-308', name: '赵六', type: '水电维修', time: '2023-06-13 14:15', status: 'pending'},
      {id: 'RX20230612', dorm: '3号楼-102', name: '孙七', type: '网络问题', time: '2023-06-12 09:50', status: 'processing'},
      {id: 'RX20230611', dorm: '1号楼-603', name: '周八', type: '家具维修', time: '2023-06-11 15:20', status: 'completed'},
      {id: 'RX20230610', dorm: '2号楼-207', name: '吴九', type: '其他问题', time: '2023-06-10 11:30', status: 'completed'}
    ];

    // 状态样式映射
    const statusConfig = {
      pending: {text: '待处理', class: 'bg-red-100 text-red-800'},
      processing: {text: '处理中', class: 'bg-yellow-100 text-yellow-800'},
      completed: {text: '已完成', class: 'bg-green-100 text-green-800'}
    };

    // 渲染报修列表
    function renderRepairs(filteredData = null) {
      const data = filteredData || repairs;
      const tbody = document.getElementById('repairList');
      tbody.innerHTML = data.map(item => `
        <tr class="border-t border-gray-100 hover:bg-gray-50">
          <td class="px-3 py-2">${item.id}</td>
          <td class="px-3 py-2">${item.dorm}</td>
          <td class="px-3 py-2">${item.name}</td>
          <td class="px-3 py-2">${item.type}</td>
          <td class="px-3 py-2">${item.time}</td>
          <td class="px-3 py-2">
            <span class="px-1.5 py-0.5 rounded text-xs ${statusConfig[item.status].class}">
              ${statusConfig[item.status].text}
            </span>
          </td>
          <td class="px-3 py-2">
            <button onclick="document.getElementById('handleModal').classList.remove('hidden')" 
                    class="text-primary text-xs hover:text-primary/80">处理</button>
          </td>
        </tr>
      `).join('');
    }

    // 筛选报修列表
    function filterRepairs() {
      const status = document.getElementById('statusFilter').value;
      const search = document.getElementById('searchRepair').value.toLowerCase();
      
      let filtered = repairs;
      
      // 状态筛选
      if (status !== 'all') {
        filtered = filtered.filter(item => item.status === status);
      }
      
      // 搜索筛选
      if (search) {
        filtered = filtered.filter(item => 
          item.dorm.toLowerCase().includes(search) || 
          item.name.toLowerCase().includes(search) ||
          item.type.toLowerCase().includes(search)
        );
      }
      
      renderRepairs(filtered);
    }

    // 图片预览功能
    function showImagePreview(src) {
      document.getElementById('previewImage').src = src;
      document.getElementById('imagePreviewModal').classList.remove('hidden');
    }

    // 初始化图表
    function initCharts() {
      // 报修类型分布图表
      const typeChart = echarts.init(document.getElementById('typeChart'));
      typeChart.setOption({
        tooltip: { trigger: 'item' },
        legend: { orient: 'vertical', left: 10 },
        series: [{
          name: '报修类型',
          type: 'pie',
          radius: '70%',
          data: [
            { value: 28, name: '水电维修' },
            { value: 15, name: '家具维修' },
            { value: 12, name: '电器维修' },
            { value: 10, name: '网络问题' },
            { value: 5, name: '其他问题' }
          ]
        }]
      });

      // 月度报修趋势图表
      const monthChart = echarts.init(document.getElementById('monthChart'));
      monthChart.setOption({
        tooltip: { trigger: 'axis' },
        xAxis: { type: 'category', data: ['1月', '2月', '3月', '4月', '5月', '6月'] },
        yAxis: { type: 'value' },
        series: [{
          data: [35, 42, 38, 55, 48, 65],
          type: 'line',
          smooth: true
        }]
      });

      // 楼宇报修数量图表
      const buildingChart = echarts.init(document.getElementById('buildingChart'));
      buildingChart.setOption({
        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
        xAxis: { type: 'category', data: ['1号楼', '2号楼', '3号楼', '4号楼', '5号楼', '6号楼'] },
        yAxis: { type: 'value' },
        series: [{
          data: [12, 19, 25, 15, 8, 6],
          type: 'bar'
        }]
      });

      // 响应窗口大小变化
      window.addEventListener('resize', () => {
        typeChart.resize();
        monthChart.resize();
        buildingChart.resize();
      });
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 渲染报修列表
      renderRepairs();
      
      // 绑定筛选事件
      document.getElementById('statusFilter').addEventListener('change', filterRepairs);
      document.getElementById('searchRepair').addEventListener('input', filterRepairs);
      
      // 关闭弹窗事件
      document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('handleModal').classList.add('hidden');
      });
      
      document.getElementById('closeImagePreview').addEventListener('click', () => {
        document.getElementById('imagePreviewModal').classList.add('hidden');
      });
      
      document.getElementById('imagePreviewModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('imagePreviewModal')) {
          document.getElementById('imagePreviewModal').classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html>
    